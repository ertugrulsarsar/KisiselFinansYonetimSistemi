<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { margin-bottom: 20px; padding: 20px; border: 1px solid #ccc; }
        .response { background: #f5f5f5; padding: 10px; margin-top: 10px; }
        button { padding: 5px 10px; margin-right: 10px; }
        input, textarea { width: 100%; margin: 5px 0; padding: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>API Test Sayfası</h1>
        
        <div class="section">
            <h2>1. Kullanıcı Kaydı</h2>
            <input type="text" id="register-username" placeholder="Kullanıcı adı">
            <input type="password" id="register-password" placeholder="Şifre">
            <input type="email" id="register-email" placeholder="E-posta">
            <button onclick="register()">Kayıt Ol</button>
            <div id="register-response" class="response"></div>
        </div>

        <div class="section">
            <h2>2. Giriş Yap</h2>
            <input type="text" id="login-username" placeholder="Kullanıcı adı">
            <input type="password" id="login-password" placeholder="Şifre">
            <button onclick="login()">Giriş Yap</button>
            <div id="login-response" class="response"></div>
        </div>

        <div class="section">
            <h2>3. Kategori Oluştur</h2>
            <input type="text" id="category-name" placeholder="Kategori adı">
            <textarea id="category-description" placeholder="Açıklama"></textarea>
            <button onclick="createCategory()">Kategori Oluştur</button>
            <div id="category-response" class="response"></div>
        </div>

        <div class="section">
            <h2>4. İşlem Oluştur</h2>
            <select id="category-select"></select>
            <input type="number" id="transaction-amount" placeholder="Miktar">
            <input type="text" id="transaction-description" placeholder="Açıklama">
            <select id="transaction-type">
                <option value="income">Gelir</option>
                <option value="expense">Gider</option>
            </select>
            <input type="date" id="transaction-date">
            <button onclick="createTransaction()">İşlem Oluştur</button>
            <div id="transaction-response" class="response"></div>
        </div>

        <div class="section">
            <h2>5. İşlemleri Listele</h2>
            <button onclick="listTransactions()">Listele</button>
            <div id="list-response" class="response"></div>
        </div>

        <div class="section">
            <h2>6. İşlem Özeti</h2>
            <button onclick="getSummary()">Özet Getir</button>
            <div id="summary-response" class="response"></div>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://localhost:5000';
        let token = '';

        async function register() {
            const data = {
                username: document.getElementById('register-username').value,
                password: document.getElementById('register-password').value,
                email: document.getElementById('register-email').value
            };

            try {
                const response = await fetch(`${BASE_URL}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                document.getElementById('register-response').innerText = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('register-response').innerText = error.message;
            }
        }

        async function login() {
            const data = {
                username: document.getElementById('login-username').value,
                password: document.getElementById('login-password').value
            };

            try {
                const response = await fetch(`${BASE_URL}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                if (result.access_token) {
                    token = result.access_token;
                }
                document.getElementById('login-response').innerText = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('login-response').innerText = error.message;
            }
        }

        async function createCategory() {
            const data = {
                name: document.getElementById('category-name').value,
                description: document.getElementById('category-description').value
            };

            try {
                const response = await fetch(`${BASE_URL}/categories/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                document.getElementById('category-response').innerText = JSON.stringify(result, null, 2);
                await updateCategorySelect();
            } catch (error) {
                document.getElementById('category-response').innerText = error.message;
            }
        }

        async function updateCategorySelect() {
            try {
                const response = await fetch(`${BASE_URL}/transactions/list`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const result = await response.json();
                const select = document.getElementById('category-select');
                select.innerHTML = '';
                result.categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.text = category.name;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Kategoriler yüklenemedi:', error);
            }
        }

        async function createTransaction() {
            const data = {
                category_id: parseInt(document.getElementById('category-select').value),
                amount: parseFloat(document.getElementById('transaction-amount').value),
                description: document.getElementById('transaction-description').value,
                transaction_type: document.getElementById('transaction-type').value,
                transaction_date: document.getElementById('transaction-date').value
            };

            try {
                const response = await fetch(`${BASE_URL}/transactions/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                document.getElementById('transaction-response').innerText = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('transaction-response').innerText = error.message;
            }
        }

        async function listTransactions() {
            try {
                const response = await fetch(`${BASE_URL}/transactions/list`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const result = await response.json();
                document.getElementById('list-response').innerText = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('list-response').innerText = error.message;
            }
        }

        async function getSummary() {
            try {
                const response = await fetch(`${BASE_URL}/transactions/summary`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const result = await response.json();
                document.getElementById('summary-response').innerText = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('summary-response').innerText = error.message;
            }
        }
    </script>
</body>
</html> 